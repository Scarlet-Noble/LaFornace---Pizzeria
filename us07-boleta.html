<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boleta - La Fornace</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles/global.css">
    <link rel="stylesheet" href="styles/us07-boleta.css">
</head>

<body>
<div class="container py-4">
    <h2 class="mb-4">Ь Boleta del Pedido</h2>

    <div id="boleta-card" class="card d-none">
        <div class="card-body">

            <h5 class="fw-bold">Detalle del Pedido</h5>

            <p><strong>C贸digo de seguimiento:</strong> <span id="codigo"></span></p>
            <p><strong>Fecha:</strong> <span id="fecha"></span></p>
            <p><strong>Estado:</strong> <span id="estado"></span></p>

            <p><strong>Cliente:</strong> <span id="cliente"></span></p>
            <p><strong>Direcci贸n:</strong> <span id="direccion"></span></p>

            <hr>

            <h6 class="fw-bold">Productos</h6>
            <ul id="lista-items" class="list-group mb-3"></ul>

            <div class="d-flex justify-content-between">
                <span>Subtotal:</span>
                <strong id="subtotal"></strong>
            </div>

            <div class="d-flex justify-content-between">
                <span>Env铆o:</span>
                <strong id="envio">$2.000</strong>
            </div>

            <hr>

            <div class="d-flex justify-content-between">
                <strong>Total:</strong>
                <strong id="total" class="text-success"></strong>
            </div>

            <button id="btn-seguimiento" class="btn btn-primary w-100 mt-4">
                Ver seguimiento del pedido
            </button>
        </div>
    </div>

    <div id="no-data" class="alert alert-danger d-none mt-4">
        No hay informaci贸n de boleta disponible.
    </div>

    <a href="index.html" class="btn btn-outline-secondary mt-4">Volver al inicio</a>
</div>

<script src="scripts/api.js"></script>
<script>
function formatoCLP(v) {
    return "$" + v.toLocaleString("es-CL");
}

document.addEventListener("DOMContentLoaded", () => {
    const boletaDiv = document.getElementById("boleta-card");
    const noData    = document.getElementById("no-data");

    const pedido = JSON.parse(localStorage.getItem("ultimo_pedido"));
    const usuario = getUsuario();

    if (!pedido) {
        noData.classList.remove("d-none");
        return;
    }

    // Mostrar contenedor
    boletaDiv.classList.remove("d-none");

    // Datos del pedido
    document.getElementById("codigo").textContent    = pedido.codigo_seguimiento;
    document.getElementById("fecha").textContent     = new Date(pedido.fecha_creacion).toLocaleString("es-CL");
    document.getElementById("estado").textContent    = pedido.estado;

    // Datos del usuario
    document.getElementById("cliente").textContent   = usuario ? usuario.nombre : "Cliente";
    document.getElementById("direccion").textContent = usuario?.direccion ?? "(Sin direcci贸n registrada)";

    // Items
    const lista = document.getElementById("lista-items");
    lista.innerHTML = "";

    let subtotal = 0;

    pedido.items.forEach(it => {
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between";

        const precio = it.precio_unitario * it.cantidad;
        subtotal += precio;

        li.innerHTML = `
            <span>${it.cantidad} Pizza #${it.pizza_id}</span>
            <span>${formatoCLP(precio)}</span>
        `;

        lista.appendChild(li);
    });

    // Mostrar subtotal y total
    document.getElementById("subtotal").textContent = formatoCLP(subtotal);
    document.getElementById("total").textContent    = formatoCLP(subtotal + 2000);

    // Bot贸n seguimiento
    document.getElementById("btn-seguimiento").onclick = () => {
        window.location.href = "us09-seguimiento.html";
    };
});
</script>
</body>
</html>
