<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - La Fornace</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles/global.css">
    <link rel="stylesheet" href="styles/us01-registro.css">
</head>

<body>
    <div class="container py-4">
        <div class="row justify-content-center">
            <div class="col-md-6">

                <div class="card mt-4 shadow">
                    <div class="card-header text-center bg-dark text-white">
                        <h3>üçï Registro de Usuario</h3>
                    </div>

                    <div class="card-body">

                        <form id="form-registro">
                            <div class="mb-3">
                                <label class="form-label">Nombre</label>
                                <input type="text" class="form-control" id="nombre" required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Correo electr√≥nico</label>
                                <input type="email" class="form-control" id="email" required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Contrase√±a</label>
                                <input type="password" class="form-control" id="password" required>
                                <small class="text-muted">M√≠nimo 8 caracteres, una may√∫scula y un n√∫mero.</small>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Direcci√≥n (opcional)</label>
                                <input class="form-control" id="direccion">
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Tel√©fono (opcional)</label>
                                <input class="form-control" id="telefono">
                            </div>

                            <button type="submit" class="btn btn-danger w-100">Crear cuenta</button>
                        </form>

                        <div id="success-msg" class="alert alert-success mt-3 d-none">
                            ‚úì Cuenta creada correctamente.
                        </div>

                        <div id="error-email" class="alert alert-danger mt-3 d-none">
                            ‚úó Ese correo ya est√° registrado.
                        </div>

                        <div id="error-password" class="alert alert-danger mt-3 d-none">
                            ‚úó La contrase√±a no cumple con los requisitos.
                        </div>

                    </div>

                    <div class="card-footer text-center">
                        <a href="us02-login.html">¬øYa tienes cuenta? Inicia sesi√≥n</a><br>
                        <a href="index.html">Volver al inicio</a>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="scripts/api.js"></script>

    <script>
        document.getElementById("form-registro").addEventListener("submit", async (e) => {
            e.preventDefault();

            const nombre = document.getElementById("nombre").value.trim();
            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("password").value.trim();
            const direccion = document.getElementById("direccion").value.trim();
            const telefono = document.getElementById("telefono").value.trim();

            const regex = /^(?=.*[A-Z])(?=.*\d).{8,}$/;

            // Validaci√≥n de contrase√±a
            if (!regex.test(password)) {
                document.getElementById("error-password").classList.remove("d-none");
                document.getElementById("error-email").classList.add("d-none");
                document.getElementById("success-msg").classList.add("d-none");
                return;
            }

            document.getElementById("error-password").classList.add("d-none");

            try {
                // Ahora enviamos tambi√©n direcci√≥n y tel√©fono
                await registrarUsuario(nombre, email, password, direccion, telefono);

                document.getElementById("success-msg").classList.remove("d-none");
                document.getElementById("error-email").classList.add("d-none");

                setTimeout(() => {
                    window.location.href = "us02-login.html";
                }, 1200);

            }catch (err) {
    const divError = document.getElementById("error-email");
    divError.classList.remove("d-none");

    if (Array.isArray(err)) {
        divError.textContent = "‚úó " + err.map(e => e.msg).join(", ");
    } else {
        divError.textContent = "‚úó " + (err.detail || "Error al registrar usuario.");
    }
}


        });
    </script>
</body>

</html>
